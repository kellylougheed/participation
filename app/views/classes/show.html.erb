<script>
$(function() {
  $(".plus").click(function() {
    var updateURL = $(event.target).data("update-url");
    var currentPoints = $(event.target).data("current-points");
    var newPoints = currentPoints + 1;
    $.ajax({
      type: 'PUT',
      url: updateURL,
      dataType: 'json',
      data: { student: { points: newPoints }}
    });
    location.reload();
  });
  $(".minus").click(function() {
    var updateURL = $(event.target).data("update-url");
    var currentPoints = $(event.target).data("current-points");
    var newPoints = currentPoints - 1;
    $.ajax({
      type: 'PUT',
      url: updateURL,
      dataType: 'json',
      data: { student: { points: newPoints }}
    });
    location.reload();
  });
});
</script>

<br/>
<div class="col-xs-10 col-xs-offset-1 text-center">

<h1><%= @course.name %></h1>
<br/>

<% if !@course.students.empty? %>
<table class="roster">
<thead>
<th>Student</th>
<th>Points</th>
<th></th>
<th>Percentage</th>
</thead><tbody>
          <% @course.students.each do |student| %>
          <tr>
          <td class="student"><%= student.last_name %>, <%= student.first_name %></td>

          <td><%= student.points %> / <%= @course.total_points %></td>

          <td><span class="plus glyphicon glyphicon-plus-sign" aria-hidden="true" data-update-url="<%= student_path(student) %>" data-current-points="<%= student.points %>"></span>

          <span class="minus glyphicon glyphicon-minus-sign" aria-hidden="true" data-update-url="<%= student_path(student) %>" data-current-points="<%= student.points %>"></span></td>

          <td><%= ((student.points.to_f)/(@course.total_points.to_f)*100).round(2) %>% </td>

          </tr>
          <% end %>
</tbody></table>
<br/>
<% else %>
<p>No students have been added to this class yet.</p>
<% end %>
<br/>

<!-- New student trigger modal -->
        <button class="btn" id="new-student" data-toggle="modal" data-target="#newStudentModal">
          New Student
        </button>

</div>

<!-- New student modal -->
<div class="modal fade" id="newStudentModal" tabindex="-1" role="dialog" aria-labelledby="newStudentLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="newStudentModalLabel">Add a new student to <%= @course.name %></h4>
      </div>
      <%= simple_form_for @new_student, url: class_students_path(@course), html: {id: 'newStudentForm'} do |f| %>
      <div class="modal-body">
          <%= f.input :first_name %><br/>
          <%= f.input :last_name %><br/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">Close</button>
        <%= f.submit 'Create', class: 'btn' %>
      </div>
      <% end %>
    </div>
  </div>
</div>