<script>
$(function() {
  $(".plus").click(function() {
    var updateURL = $(event.target).data("update-url");
    var startingPoints = $(event.target).data("starting-points");
    var currentPoints = $(event.target).data("current-points");
    var newPoints = currentPoints + 1;
    $.ajax({
      type: 'PUT',
      url: updateURL,
      dataType: 'json',
      data: { student: { points: newPoints }}
    });
    location.reload();
  });
  $(".minus").click(function() {
    var updateURL = $(event.target).data("update-url");
    var startingPoints = $(event.target).data("starting-points");
    var currentPoints = $(event.target).data("current-points");
    var newPoints = currentPoints - 1;
    $.ajax({
      type: 'PUT',
      url: updateURL,
      dataType: 'json',
      data: { student: { points: newPoints }}
    });
    location.reload();
  });
  $(".reset").click(function() {
    var updateURL = $(event.target).data("update-url");
    var startingPoints = $(event.target).data("starting-points");
    var confirmed = confirm("Are you sure you wish to reset this student's points to the default value?");
    if (confirmed === true) {
      $.ajax({
        type: 'PUT',
        url: updateURL,
        dataType: 'json',
        data: { student: { points: startingPoints }}
      });
      location.reload();
    }
  });
});
</script>

<br/>
<div class="col-sm-10 col-sm-offset-1 text-center">

<h1><%= @course.name %> </h1>
<br/><br/>

<% if !@course.students.empty? %>
<table class="roster">
<thead>
<th class="control-panel"></th>
<th class="student">Student</th>
<th>Points</th>
<th></th>
<th class="percentage">Percentage</th>
</thead><tbody>
          <% @course.students.order("last_name").each do |student| %>
          <tr>
          <td class="control-panel">
            <%= link_to student_path(student), method: :delete, data: {confirm: 'Are you sure you want to delete this student?'} do %>
            <span class="glyphicon glyphicon-trash" aria-hidden="true" data-update-url="<%= student_path(student) %>"></span>
            <% end %>

            <span class="glyphicon glyphicon-erase link reset" aria-hidden="true" data-update-url="<%= student_path(student) %>" data-starting-points="<%= @course.starting_points %>"></span>

          </td>
          <td class="student"><%= student.last_name %>, <%= student.first_name %>
          <%= link_to student_path(student) do %>
            <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
          <% end %>
          </td>

          <td><%= student.points %><span id="total-points"> / <%= @course.total_points %></span></td>

          <td class="toggle-grade"><span class="plus glyphicon glyphicon-plus-sign" aria-hidden="true" data-update-url="<%= student_path(student) %>" data-current-points="<%= student.points %>" data-starting-points="<%= @course.starting_points %>"></span>

          <span class="minus glyphicon glyphicon-minus-sign" aria-hidden="true" data-update-url="<%= student_path(student) %>" data-current-points="<%= student.points %>" data-starting-points="<%= @course.starting_points %>"></span></td>

          <td class="percentage"><%= ((student.points.to_f)/(@course.total_points.to_f)*100).round(2) %>% </td>

          </tr>
          <% end %>
</tbody></table>
<br/>
<% else %>
<p>No students have been added to this class yet.</p>
<% end %>
<br/>

<hr/>

<!-- New student trigger modal -->
        <button class="btn" id="new-student" data-toggle="modal" data-target="#newStudentModal">
           <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New Student
        </button>
        <br/><br/>

<%= link_to edit_class_path(@course) do %>
<span class="link reset-all"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit Class Info</span>
<% end %>
<br/><br/>

<%= link_to class_reset_all_path(@course), method: :put, data: {confirm: 'Are you sure you want to reset all students\' points?' } do %>
<span class="link reset-all"><span class="glyphicon glyphicon-erase" aria-hidden="true"></span> Reset All Points</span>
<% end %>
<br/><br/>

<%= link_to class_path(@course), method: :delete, data: {confirm: 'Are you sure you want to delete this class?'} do %>
  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete Class
<% end %>

</div>

<!-- New student modal -->
<div class="modal fade" id="newStudentModal" tabindex="-1" role="dialog" aria-labelledby="newStudentLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="newStudentModalLabel">Add a new student to <%= @course.name %></h4>
      </div>
      <%= simple_form_for @new_student, url: class_students_path(@course), html: {id: 'newStudentForm'} do |f| %>
      <div class="modal-body">
          <%= f.input :first_name %><br/>
          <%= f.input :last_name %><br/>
          <%= f.input :email_address, label: 'Email address (optional) <span class="glyphicon glyphicon-info-sign" aria-hidden="true">'.html_safe %><br/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">Close</button>
        <%= f.submit 'Create', class: 'btn' %>
      </div>
      <% end %>
    </div>
  </div>
</div>
